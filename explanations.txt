–ì–û–¢–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

–°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç:

wp-dev-docker/
    docker-compose.yml
    .env
    wordpress/           ‚Üê —Ç—É—Ç –±—É–¥–µ—Ç WordPress
    plugins/             ‚Üê —Å—é–¥–∞ –∫–ª–∞–¥—ë—à—å —Å–≤–æ–∏ –ø–ª–∞–≥–∏–Ω—ã (React –±–ª–æ–∫–∏)
    themes/              ‚Üê —Ç—É—Ç —Ç–µ–º—ã
    config/              ‚Üê –í–Ω—É—Ç—Ä–∏ config/ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª nginx.conf




–°–æ–∑–¥–∞–π –ø–∞–ø–∫–∏:

mkdir wp-dev-docker
cd wp-dev-docker

mkdir wordpress
mkdir plugins
mkdir themes

üü¶ 1. –§–ê–ô–õ .env

–°–æ–∑–¥–∞–π:

# WordPress
WORDPRESS_PORT=8080

# Adminer
ADMINER_PORT=8081

# DB
MYSQL_ROOT_PASSWORD=rootpass
MYSQL_DATABASE=wordpress
MYSQL_USER=wpuser
MYSQL_PASSWORD=wppass

# UID/GID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
LOCAL_UID=1000
LOCAL_GID=1000

üüß 2. –§–ê–ô–õ docker-compose.yml ‚Äî –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø

–í—Å—Ç–∞–≤—å —ç—Ç–æ:

services:
  wordpress:
    image: wordpress:6.6-fpm
    container_name: wp-dev
    depends_on:
      - db
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: ${MYSQL_USER}
      WORDPRESS_DB_PASSWORD: ${MYSQL_PASSWORD}
      WORDPRESS_DB_NAME: ${MYSQL_DATABASE}
    volumes:
      - ./wordpress:/var/www/html
      - ./plugins:/var/www/html/wp-content/plugins
      - ./themes:/var/www/html/wp-content/themes
    user: "${LOCAL_UID}:${LOCAL_GID}"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - wpnet

  webserver:
    image: nginx:latest
    container_name: wp-nginx
    depends_on:
      - wordpress
    ports:
      - "${WORDPRESS_PORT}:80"
    volumes:
      - ./wordpress:/var/www/html
      - ./plugins:/var/www/html/wp-content/plugins
      - ./themes:/var/www/html/wp-content/themes
      - ./config/nginx.conf:/etc/nginx/conf.d/default.conf
    networks:
      - wpnet

  db:
    image: mariadb:10.5
    container_name: wp-db
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - wpnet

  adminer:
    image: adminer
    container_name: wp-adminer
    restart: always
    ports:
      - "${ADMINER_PORT}:8080"
    networks:
      - wpnet

  wpcli:
    image: wordpress:cli
    container_name: wp-cli
    depends_on:
      - wordpress
    user: "${LOCAL_UID}:${LOCAL_GID}"
    volumes:
      - ./wordpress:/var/www/html
      - ./plugins:/var/www/html/wp-content/plugins
      - ./themes:/var/www/html/wp-content/themes
    entrypoint: ["wp"]
    networks:
      - wpnet

volumes:
  db_data:

networks:
  wpnet:

üü© 3. nginx –∫–æ–Ω—Ñ–∏–≥

–°–æ–∑–¥–∞–π:

config/nginx.conf

server {
    listen 80;
    server_name localhost;

    root /var/www/html;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        fastcgi_pass wordpress:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}

üöÄ 4. –ó–ê–ü–£–°–ö

–í –∫–æ—Ä–Ω–µ:

docker compose up -d


–û—Ç–∫—Ä—ã–≤–∞–µ—à—å:

WordPress:

üëâ http://localhost:8080

Adminer:

üëâ http://localhost:8081

Server: db
User: wpuser
Pass: wppass

üü™ 5. WP-CLI –≤ Docker

–ö–ª–∞—Å—Å! –¢–µ–ø–µ—Ä—å WP-CLI —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å:

–ù–∞–ø—Ä–∏–º–µ—Ä:
docker compose run --rm wpcli plugin list


–£—Å—Ç–∞–Ω–æ–≤–∫–∞ WordPress:

docker compose run --rm wpcli core install \
  --url=http://localhost:8080 \
  --title="Dev WP" \
  --admin_user=admin \
  --admin_password=admin \
  --admin_email=admin@example.com

üü¶ 6. –ü–∞–ø–∫–∞ –¥–ª—è —Ç–≤–æ–µ–≥–æ Gutenberg –ø–ª–∞–≥–∏–Ω–∞ (React)

–¢–≤–æ–π –ø–ª–∞–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –∑–¥–µ—Å—å:

wp-dev-docker/plugins/wp-gutenberg-slider/


–ò WordPress –µ–≥–æ —É–≤–∏–¥–∏—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏
(–ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç UID=1000/GID=1000).

üü© 7. –î–æ—Å—Ç—É–ø –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä WordPress
docker compose exec wordpress bash


–ò –≤–Ω—É—Ç—Ä–∏ —Ç—ã –±—É–¥–µ—à—å –≤:

/var/www/html

üü® 8. Node.js –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–æ–≤

Node –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Ç–∞–≤–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!

–ù—É–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å Node.js –Ω–∞ —Ö–æ—Å—Ç–µ:

sudo apt install nodejs npm


–î–∞–ª—å—à–µ:

cd plugins/wp-gutenberg-slider
npm install
npm run dev


–ò —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (volume mount).

üéâ –ì–æ—Ç–æ–≤–æ!

–¢—ã –ø–æ–ª—É—á–∏–ª –∏–¥–µ–∞–ª—å–Ω—ã–π Docker-—Å—Ç–µ–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Gutenberg –±–ª–æ–∫–æ–≤ –Ω–∞ React:

–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏

—Ä–∞–±–æ—Ç–∞–µ—Ç WP-CLI

–µ—Å—Ç—å Adminer

–µ—Å—Ç—å nginx

—á–∏—Å—Ç—ã–π PHP-FPM

–æ—Ç–¥–µ–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è —Ç–≤–æ–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤

Node.js —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ö–æ—Å—Ç–µ ‚Äî –±–µ–∑ –≥–µ–º–æ—Ä–∞

======================================================
!!!
–ø–ª—é—Å –¥–ª—è image 

–†–µ—à–µ–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ
1Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É uploads

–ù–∞ —Ö–æ—Å—Ç–µ (–≤ –∫–æ—Ä–Ω–µ wordpress):

mkdir -p wordpress/wp-content/uploads

2Ô∏è‚É£ –î–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (—Ç–æ—Ç –∂–µ, —á—Ç–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
sudo chown -R 1000:1000 wordpress/wp-content/uploads


–∏–ª–∏ –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–≤–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

chown -R $USER:$USER wordpress/wp-content/uploads

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
chmod -R 775 wordpress/wp-content/uploads


7 –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ ‚Üí —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å/–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

7 –¥–ª—è –≥—Ä—É–ø–ø—ã ‚Üí —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å/–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

5 –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö ‚Üí —á—Ç–µ–Ω–∏–µ/–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ